extends base

block styles
  link(rel="stylesheet" href="/css/dashboard.css")

block content

  // =========================
  // NAVBAR
  // =========================
  nav.navbar
    .nav-logo
      if user.userType === "user"
        a.dashboard-btn(href='/dashboard')
          img(src="/img/gymspirelogo.png" alt="GymSpire Logo")
      if user.userType === "coach"
        a.dashboard-btn(href='/coachDashboard') 
          img(src="/img/gymspirelogo.png" alt="GymSpire Logo")
      if user.userType === "admin"
        a.dashboard-btn(href='/adminDashboard') 
          img(src="/img/gymspirelogo.png" alt="GymSpire Logo")
    .nav-right
      button.hamburger ☰
      .panel
        a(href="/profile") Profile
        form(action="/api/v1/auth/logout" method="GET")
          button(type="submit") Logout

  // =========================
  // WELCOME SECTION
  // =========================
  .welcome-section
    img.app-logo(src="/img/gymspirelogo.png" alt="GymSpire Logo")
    h2 Welcome, #{user.username}

  // =========================
  // STATUS SECTION
  // =========================
  //- .status-section
  //-   h3 GymSpire Time Status
  //-   p
  //-     if recommended
  //-       strong Recommended to workout now
  //-     else
  //-       strong Not recommended to workout now
  //-   p #{message}
  //-   p
  //-     | Current time:
  //-     - const period = currentHour >= 12 ? "PM" : "AM";
  //-     - const displayHour = currentHour % 12 || 12;
  //-     span #{displayHour}:00 #{period}
  //-   p
  //-     | Current gym load:
  //-     span #{currentLoad}
  //-   p
  //-     | Crowd level:
  //-     span #{crowdLevel}

      // Main recommendation result
  p
    if recommended
      strong Recommended to workout now
    else
      strong Not recommended to workout now

  // Explanation message
  p #{message}

  p
    | Current time: 
    strong #{currentTime}

  p
    | Current gym load: 
    data(value=currentLoad) #{currentLoad}

  h3 Currently Working Out

  if onlineUsers.length === 0
    p No users are currently working out.
  else
    .online-users
      each u in onlineUsers
        .online-user
          if u.pfpUrl
            img(
              src=u.pfpUrl
              alt=u.username
              width="40"
              height="40"
              style="border-radius:50%;"
            )
          else
            img(
              src="/img/default-user.png"
              alt=u.username
              width="40"
              height="40"
              style="border-radius:50%;"
            )

          span= u.username

  // =========================
  // Muscle Group Workout Couunt this Week
  // =========================
  
  if frequencies.length === 0
    p No workout data available for this week.
  else
    ul.frequency-list
      each item in frequencies
        li.frequency-item(class=item.trained >= item.target ? "complete" : "incomplete")
          span.muscle-name #{item.muscle}
          span.muscle-count #{item.trained} / #{item.target}

  p
    | Workouts this week: 
    if workoutCount === 0
      strong No workout yet
    else
      strong #{workoutCount}

  // =========================
  // DASHBOARD GRID
  // =========================
  .dashboard
    - const cards = ["Challenges", "Workout Plan", "Workout Logs", "Solo Workout"];
    each item, index in cards
      .card
        h3 #{item}
        .card-actions
          - let url = '/' + item.toLowerCase().replaceAll(' ', '-'); // ✅ convert spaces to hyphens
          - url = url === '/start-solo-workout' ? '/startSoloWorkout' : url;
          - console.log(url)
          a.card-link(href=url) #{item}
          button.info-btn(data-index=index title="More Info") i

  // =========================
  // MODAL
  // =========================
  .modal.hidden#modal
    .modal-content
      button#closeModal ×
      video#modalVideo(autoplay muted loop playsinline)
      p#modalText

  // =========================
  // DASHBOARD JS
  // =========================
  script(src="/js/dashboard.js")

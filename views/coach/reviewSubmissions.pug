extends ../base

block styles
  link(rel="stylesheet", href="/css/reviewSubmissions.css")

block content
  // =========================
  // TOP BAR
  // =========================
  .top-bar
    a.dashboard-btn(href="/coach/dashboard") Dashboard
    a.back-btn(href="javascript:history.back()") Back

  h1 #{title}
  h2 Coach: #{user.username}

  if !submissions || submissions.length === 0
    p No submissions yet for this challenge.
  else
    each log in submissions
      .submission-card
        // Error message placeholder
        p.error-message(style="color:red; font-weight:bold; display:none; margin-top:10px;")

        // =====================
        // User & Meta Info
        // =====================
        if log.userId && log.userId.username
          h3 Submission by #{log.userId.username}
        else
          h3 Submission by User

        p Date: #{log.createdAt ? log.createdAt.toDateString() : 'Unknown'}

        // =====================
        // Status Badge
        // =====================
        p
          | Status:
          if log.judgeStatus === "approved"
            span.status.approved Approved
          else if log.judgeStatus === "rejected"
            span.status.rejected Rejected
          else
            span.status.pending Pending

        // =====================
        // Exercises & Sets (FULL DETAIL)
        // =====================
        h4 Exercises & Sets
        if log.exercises && log.exercises.length
          each ex in log.exercises
            .exercise-block
              h4 #{ex.name} (#{ex.target})

              if ex.set && ex.set.length
                table
                  thead
                    tr
                      th Set #
                      th Type
                      th Weight
                      th Reps
                      th Rest (sec)
                  tbody
                    each s in ex.set
                      tr
                        td #{s.setNumber || '-'}
                        td #{s.type || '-'}
                        td #{s.weight || '-'} #{s.unit || ''}
                        td #{s.reps || '-'}
                        td #{s.restSeconds || '-'}
              else
                p No sets submitted.
        else
          p No exercises submitted.

        // =====================
        // Video Preview
        // =====================
        if log.videoUrl
          video(controls width="250" style="margin-top:10px; border-radius:6px;")
            source(src=log.videoUrl type="video/mp4")
        else
          p(style="color:red; margin-top:5px") ⚠️ No video submitted.

        // =====================
        // Verification Actions
        // =====================
        if log.judgeStatus === "pending"
          form.verify-form(
            data-log-id=log._id
            action=`/api/v1/workout-logs/${log._id}/verify`
            method="POST"
            class="verify-form"
          )
            label(for="judgeNotes") Coach Notes
            textarea(
              name="judgeNotes"
              rows="3"
              placeholder="Enter feedback for the athlete..."
            )

            br
            br

            button.approve(type="submit" name="decision" value="approved") ✅ Approve
            button.reject(type="submit" name="decision" value="rejected") ❌ Reject
        else
          p.reviewed This submission has already been reviewed.

          if log.judgeNotes
            p
              strong Coach Notes:
              |  #{log.judgeNotes}

block scripts
  script(src="/js/reviewSubmissions.js")

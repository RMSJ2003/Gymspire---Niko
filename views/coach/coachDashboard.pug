extends ../base

block styles
  link(rel="stylesheet" href="/css/dashboard.css?v=1.1")

block content

  // =========================
  // NAVBAR + PANEL
  // =========================
  nav.navbar
    .nav-logo
      a.dashboard-btn(href='/coachDashboard')
        img(src="/img/gymspirelogo.png" alt="GymSpire Logo")
    .nav-right
      button.hamburger ☰
      .panel
        a(href='/profile') Profile
        form(action="/api/v1/auth/logout" method="GET")
          button(type="submit") Logout

  // =========================
  // WELCOME / HEADER
  // =========================
  .welcome-section
    h1 Dashboard
    h2 Welcome, #{user.username}

  // =========================
  // STATUS SECTION
  // =========================
  .status-section
    h3 GymSpire Time Status
    p
      if recommended
        strong.status-good Recommended to workout now
      else
        strong.status-bad Not recommended to workout now
    p #{message}
    p
      | Current time:
      - const period = currentHour >= 12 ? "PM" : "AM";
      - const displayHour = currentHour % 12 || 12;
      span #{displayHour}:00 #{period}
    p
      | Current gym load:
      span.highlight #{currentLoad}
    p
      | Crowd level:
      span.highlight #{crowdLevel}

  // =========================
  // DASHBOARD GRID
  // =========================
  .dashboard
    - const cards = ["Workout Plan", "Challenges", "Workout Logs", "Start Solo Workout"];
    each item, index in cards
      .card
        h3 #{item}
        .card-actions
          a.card-link(href="#") #{item}
          button.info-btn(data-index=index title="More Info") i

  // =========================
  // MODAL
  // =========================
  .modal.hidden#modal
    .modal-content
      button#closeModal ×
      video#modalVideo(autoplay muted loop playsinline)
      p#modalText

block scripts
  script.
    // =========================
    // HAMBURGER PANEL TOGGLE
    // =========================
    document.addEventListener("DOMContentLoaded", () => {
      const hamburger = document.querySelector(".hamburger");
      const panel = document.querySelector(".panel");

      hamburger.addEventListener("click", () => {
        panel.classList.toggle("open");
      });

      // =========================
      // MODAL FUNCTIONALITY
      // =========================
      const modal = document.getElementById("modal");
      const modalText = document.getElementById("modalText");
      const modalVideo = document.getElementById("modalVideo");
      const closeModal = document.getElementById("closeModal");

      const infoData = [
        { text: "Plan your workouts effectively with GymSpire.", video: "/clip/workout_plan.mp4" },
        { text: "Check out daily challenges to improve your workouts.", video: "/clip/challenges.mp4" },
        { text: "Track your workout logs over time.", video: "/clip/workout_logs.mp4" },
        { text: "Start a solo workout anytime.", video: "/clip/solo.mp4" },
      ];

      document.querySelectorAll(".info-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const index = btn.dataset.index;
          modalText.textContent = infoData[index].text;
          modalVideo.src = infoData[index].video;
          modal.classList.remove("hidden");
          modalVideo.play();
        });
      });

      closeModal.addEventListener("click", () => {
        modal.classList.add("hidden");
        modalVideo.pause();
        modalVideo.currentTime = 0;
      });

      modal.addEventListener("click", (e) => {
        if (e.target === modal) {
          modal.classList.add("hidden");
          modalVideo.pause();
          modalVideo.currentTime = 0;
        }
      });

      // =========================
      // CARD LINKS
      // =========================
      const routes = {
        "Workout Plan": "/workoutPlan",
        Challenges: "/challenges",
        "Workout Logs": "/workoutLogs",
        "Start Solo Workout": "/startSoloWorkout",
      };

      document.querySelectorAll(".card").forEach((card) => {
        const link = card.querySelector(".card-link");
        if (!link) return;

        const text = link.textContent.trim();
        link.href = routes[text] || "#";
      });
    });
